var Le=Object.defineProperty;var ye=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ve=(e,r,o)=>r in e?Le(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,O=(e,r)=>{for(var o in r||(r={}))Pe.call(r,o)&&ve(e,o,r[o]);if(ye)for(var o of ye(r))Me.call(r,o)&&ve(e,o,r[o]);return e};var D=(e,r,o)=>new Promise((p,h)=>{var b=u=>{try{c(o.next(u))}catch(d){h(d)}},l=u=>{try{c(o.throw(u))}catch(d){h(d)}},c=u=>u.done?p(u.value):Promise.resolve(u.value).then(b,l);c((o=o.apply(e,r)).next())});import{bk as Ne,bj as ke,a as Ie,cY as _e,cZ as Ye,aG as B,f as _,c as ze,aw as De,ay as H,o as q,j as X,z as Y,i as He,bo as Ue,n as ie,aC as U,az as ee,B as le,t as ue,l as se,aD as ae,bt as W,c_ as te,ax as ce,k as n,aH as re,c$ as me,d0 as J,d1 as pe,ai as K,cT as We,a8 as x,d2 as Ge,cB as qe,bv as Ce,bs as Ke,aN as Xe,am as he,an as ge,d3 as Be,d4 as Fe,d5 as Ve,d6 as Je,L as Ze,w as we,v as Q,b as Qe,N as xe,h as et,aB as de,F as tt,aA as Oe,aE as fe,D as nt}from"./index.0994ffcf.js";/* empty css              *//* empty css               */import{d as ot,h as st,a as je,_ as at}from"./FormItem.vue_vue_type_script_lang.1addcaf5.js";import"./index.b32d7fc7.js";import{F as $e}from"./Form.5eb5121e.js";import{C as Te}from"./index.09d33596.js";import{u as rt}from"./uniqBy.485a2f6d.js";import{u as it}from"./index.b7f80407.js";import{R as ct}from"./index.ec7b7cf8.js";const Ee=Symbol();function lt(e){return ke(e,Ee)}function ut(){return Ne(Ee)}const dt=Ie({name:"BasicFormAction",components:{FormItem:$e.Item,Button:_e,BasicArrow:Ye,[Te.name]:Te},props:{showActionButtonGroup:B.bool.def(!0),showResetButton:B.bool.def(!0),showSubmitButton:B.bool.def(!0),showAdvancedButton:B.bool.def(!0),resetButtonOptions:{type:Object,default:()=>({})},submitButtonOptions:{type:Object,default:()=>({})},actionColOptions:{type:Object,default:()=>({})},actionSpan:B.number.def(6),isAdvanced:B.bool,hideAdvanceBtn:B.bool},emits:["toggle-advanced"],setup(e,{emit:r}){const{t:o}=ze(),p=_(()=>{const{showAdvancedButton:c,actionSpan:u,actionColOptions:d}=e,v=24-u,w=c?{span:v<6?24:v}:{};return O(O({style:{textAlign:"right"},span:c?6:4},w),d)}),h=_(()=>Object.assign({text:o("common.resetText")},e.resetButtonOptions)),b=_(()=>Object.assign({text:o("common.queryText")},e.submitButtonOptions));function l(){r("toggle-advanced")}return O({t:o,actionColOpt:p,getResetBtnOptions:h,getSubmitBtnOptions:b,toggleAdvanced:l},ut())}});function ft(e,r,o,p,h,b){const l=H("Button"),c=H("BasicArrow"),u=H("FormItem"),d=H("a-col");return e.showActionButtonGroup?(q(),X(d,ae(ee({key:0},e.actionColOpt)),{default:Y(()=>[He("div",{style:Ue([{width:"100%"},{textAlign:e.actionColOpt.style.textAlign}])},[ie(u,null,{default:Y(()=>[U(e.$slots,"resetBefore"),e.showResetButton?(q(),X(l,ee({key:0,type:"default",class:"mr-2"},e.getResetBtnOptions,{onClick:e.resetAction}),{default:Y(()=>[le(ue(e.getResetBtnOptions.text),1)]),_:1},16,["onClick"])):se("",!0),U(e.$slots,"submitBefore"),e.showSubmitButton?(q(),X(l,ee({key:1,type:"primary",class:"mr-2"},e.getSubmitBtnOptions,{onClick:e.submitAction}),{default:Y(()=>[le(ue(e.getSubmitBtnOptions.text),1)]),_:1},16,["onClick"])):se("",!0),U(e.$slots,"advanceBefore"),e.showAdvancedButton&&!e.hideAdvanceBtn?(q(),X(l,{key:2,type:"link",size:"small",onClick:e.toggleAdvanced},{default:Y(()=>[le(ue(e.isAdvanced?e.t("component.form.putAway"):e.t("component.form.unfold"))+" ",1),ie(c,{class:"ml-1",expand:!e.isAdvanced,up:""},null,8,["expand"])]),_:1},8,["onClick"])):se("",!0),U(e.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):se("",!0)}var pt=De(dt,[["render",ft]]);function mt(e,r,o){const p=/^\[(.+)\]$/;if(p.test(e)){const h=e.match(p);if(h&&h[1]){const b=h[1].split(",");return r=Array.isArray(r)?r:[r],b.forEach((l,c)=>{me(o,l.trim(),r[c])}),!0}}}function ht(e,r,o){const p=/^\{(.+)\}$/;if(p.test(e)){const h=e.match(p);if(h&&h[1]){const b=h[1].split(",");return r=W(r)?r:{},b.forEach(l=>{me(o,l.trim(),r[l.trim()])}),!0}}}function bt({defaultValueRef:e,getSchema:r,formModel:o,getProps:p}){function h(c){var d,v;if(!W(c))return{};const u={};for(const w of Object.entries(c)){let[,s]=w;const[j]=w;if(!j||te(s)&&s.length===0||ce(s))continue;const C=n(p).transformDateFunc;W(s)&&(s=C==null?void 0:C(s)),te(s)&&((d=s[0])==null?void 0:d.format)&&((v=s[1])==null?void 0:v.format)&&(s=s.map(M=>C==null?void 0:C(M))),re(s)&&(s===""?s=void 0:s=s.trim()),!mt(j,s,u)&&!ht(j,s,u)&&me(u,j,s)}return b(u)}function b(c){const u=n(p).fieldMapToTime;if(!u||!Array.isArray(u))return c;for(const[d,[v,w],s="YYYY-MM-DD"]of u){if(!d||!v||!w)continue;if(!c[d]){Reflect.deleteProperty(c,d);continue}const[j,C]=c[d],[M,m]=Array.isArray(s)?s:[s,s];c[v]=J(j).format(M),c[w]=J(C).format(m),Reflect.deleteProperty(c,d)}return c}function l(){const c=n(r),u={};c.forEach(d=>{const{defaultValue:v}=d;pe(v)||(u[d.field]=v,o[d.field]===void 0&&(o[d.field]=v))}),e.value=K(u)}return{handleFormValues:h,initDefault:l}}const G=24;function At({advanceState:e,emit:r,getProps:o,getSchema:p,formModel:h,defaultValueRef:b}){const l=Xe(),{realWidthRef:c,screenEnum:u,screenRef:d}=We(),v=_(()=>{if(!e.isAdvanced)return 0;const m=n(o).emptySpan||0;if(qe(m))return m;if(W(m)){const{span:F=0}=m,N=n(d);return m[N.toLowerCase()]||F||0}return 0}),w=Ce(C,30);x([()=>n(p),()=>e.isAdvanced,()=>n(c)],()=>{const{showAdvancedButton:m}=n(o);m&&w()},{immediate:!0});function s(m,F=0,N=!1){const L=n(c),$=parseInt(m.md)||parseInt(m.xs)||parseInt(m.sm)||m.span||G,V=parseInt(m.lg)||$,k=parseInt(m.xl)||V,t=parseInt(m.xxl)||k;return L<=u.LG?F+=$:L<u.XL?F+=V:L<u.XXL?F+=k:F+=t,N?(e.hideAdvanceBtn=!1,F<=G*2?(e.hideAdvanceBtn=!0,e.isAdvanced=!0):F>G*2&&F<=G*(n(o).autoAdvancedLine||3)?e.hideAdvanceBtn=!1:e.isLoad||(e.isLoad=!0,e.isAdvanced=!e.isAdvanced),{isAdvanced:e.isAdvanced,itemColSum:F}):F>G*(n(o).alwaysShowLines||1)?{isAdvanced:e.isAdvanced,itemColSum:F}:{isAdvanced:!0,itemColSum:F}}const j=Ge({});function C(){var L;let m=0,F=0;const{baseColProps:N={}}=n(o);for(const $ of n(p)){const{show:V,colProps:k}=$;let t=!0;if(Ke(V)&&(t=V),ce(V)&&(t=V({schema:$,model:h,field:$.field,values:O(O({},n(b)),h)})),t&&(k||N)){const{itemColSum:a,isAdvanced:g}=s(O(O({},N),k),m);m=a||0,g&&(F=m),j[$.field]=g}}(L=l==null?void 0:l.proxy)==null||L.$forceUpdate(),e.actionSpan=F%G+n(v),s(n(o).actionColOptions||{span:G},m,!0),r("advanced-change")}function M(){e.isAdvanced=!e.isAdvanced}return{handleToggleAdvanced:M,fieldsIsAdvancedMap:j}}function yt({emit:e,getProps:r,formModel:o,getSchema:p,defaultValueRef:h,formElRef:b,schemaRef:l,handleFormValues:c}){function u(){return D(this,null,function*(){const{resetFunc:t,submitOnReset:a}=n(r);t&&ce(t)&&(yield t()),n(b)&&(Object.keys(o).forEach(i=>{const f=n(p).find(E=>E.field===i),y=(f==null?void 0:f.component)&&ot.includes(f.component),T=K(h.value[i]);o[i]=y?T||"":T}),he(()=>$()),e("reset",ge(o)),a&&k())})}function d(t){return D(this,null,function*(){const a=n(p).map(y=>y.field).filter(Boolean),g=".",i=a.filter(y=>String(y).indexOf(g)>=0),f=[];Object.keys(t).forEach(y=>{const T=n(p).find(R=>R.field===y);let E=t[y];const ne=Reflect.has(t,y);E=st(T==null?void 0:T.component,E);const{componentProps:oe}=T||{};let S=oe;if(typeof oe=="function"&&(S=S({formModel:n(o)})),ne&&a.includes(y)){if(F(y))if(Array.isArray(E)){const R=[];for(const z of E)R.push(z?J(z):null);n(o)[y]=R}else n(o)[y]=E?S!=null&&S.valueFormat?E:J(E):null;else n(o)[y]=E;S!=null&&S.onChange&&(S==null||S.onChange(E)),f.push(y)}else i.forEach(R=>{try{const z=R.split(".").reduce((Z,A)=>Z[A],t);Be(z)&&(n(o)[R]=n(z),f.push(R))}catch(z){Be(h.value[R])&&(n(o)[R]=K(n(h.value[R])))}})}),N(f).catch(y=>{})})}function v(t){return D(this,null,function*(){const a=K(n(p));if(!t)return;let g=re(t)?[t]:t;re(t)&&(g=[t]);for(const i of g)w(i,a);l.value=a})}function w(t,a){if(re(t)){const g=a.findIndex(i=>i.field===t);g!==-1&&(delete o[t],a.splice(g,1))}}function s(t,a,g=!1){return D(this,null,function*(){const i=K(n(p)),f=i.findIndex(T=>T.field===a),y=W(t)?[t]:t;if(!a||f===-1||g){g?i.unshift(...y):i.push(...y),l.value=i,M(t);return}f!==-1&&i.splice(f+1,0,...y),M(t),l.value=i})}function j(t){return D(this,null,function*(){let a=[];if(W(t)&&a.push(t),te(t)&&(a=[...t]),!a.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}l.value=a})}function C(t){return D(this,null,function*(){let a=[];if(W(t)&&a.push(t),te(t)&&(a=[...t]),!a.every(f=>f.component==="Divider"||Reflect.has(f,"field")&&f.field)){Fe("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];n(p).forEach(f=>{let y;if(a.forEach(T=>{f.field===T.field&&(y=T)}),y!==void 0&&f.field===y.field){const T=Ve(f,y);i.push(T)}else i.push(f)}),M(i),l.value=rt(i,"field")})}function M(t){let a=[];W(t)&&a.push(t),te(t)&&(a=[...t]);const g={},i=m();a.forEach(f=>{f.component!="Divider"&&Reflect.has(f,"field")&&f.field&&!pe(f.defaultValue)&&(!(f.field in i)||pe(i[f.field])||Je(i[f.field]))&&(g[f.field]=f.defaultValue)}),d(g)}function m(){return n(b)?c(ge(n(o))):{}}function F(t){return n(p).some(a=>a.field===t?je.includes(a.component):!1)}function N(t){return D(this,null,function*(){var a;return(a=n(b))==null?void 0:a.validateFields(t)})}function L(t){return D(this,null,function*(){var a;return yield(a=n(b))==null?void 0:a.validate(t)})}function $(t){return D(this,null,function*(){var a;yield(a=n(b))==null?void 0:a.clearValidate(t)})}function V(t,a){return D(this,null,function*(){var g;yield(g=n(b))==null?void 0:g.scrollToField(t,a)})}function k(t){return D(this,null,function*(){t&&t.preventDefault();const{submitFunc:a}=n(r);if(a&&ce(a)){yield a();return}if(!!n(b))try{const i=yield L(),f=c(i);e("submit",f)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i==null?void 0:i.errorFields))return;throw new Error(i)}})}return{handleSubmit:k,clearValidate:$,validate:L,validateFields:N,getFieldsValue:m,updateSchema:C,resetSchema:j,appendSchemaByField:s,removeSchemaByField:v,resetFields:u,setFieldsValue:d,scrollToField:V}}function vt(h){return D(this,arguments,function*({getSchema:e,getProps:r,formElRef:o,isInitedDefault:p}){Ze(()=>D(this,null,function*(){if(n(p)||!n(r).autoFocusFirstItem)return;yield he();const b=n(e),l=n(o),c=l==null?void 0:l.$el;if(!l||!c||!b||b.length===0||!b[0].component.includes("Input"))return;const d=c.querySelector(".ant-row:first-child input");!d||d==null||d.focus()}))})}const gt={model:{type:Object,default:()=>({})},labelWidth:{type:[Number,String],default:0},fieldMapToTime:{type:Array,default:()=>[]},compact:B.bool,schemas:{type:Array,default:()=>[]},mergeDynamicData:{type:Object,default:null},baseRowStyle:{type:Object},baseColProps:{type:Object},autoSetPlaceHolder:B.bool.def(!0),autoSubmitOnEnter:B.bool.def(!1),submitOnReset:B.bool,submitOnChange:B.bool,size:B.oneOf(["default","small","large"]).def("default"),disabled:B.bool,emptySpan:{type:[Number,Object],default:0},showAdvancedButton:B.bool,transformDateFunc:{type:Function,default:e=>{var r,o;return(o=(r=e==null?void 0:e.format)==null?void 0:r.call(e,"YYYY-MM-DD HH:mm:ss"))!=null?o:e}},rulesMessageJoinLabel:B.bool.def(!0),autoAdvancedLine:B.number.def(3),alwaysShowLines:B.number.def(1),showActionButtonGroup:B.bool.def(!0),actionColOptions:Object,showResetButton:B.bool.def(!0),autoFocusFirstItem:B.bool,resetButtonOptions:Object,showSubmitButton:B.bool.def(!0),submitButtonOptions:Object,resetFunc:Function,submitFunc:Function,hideRequiredMark:B.bool,labelCol:Object,layout:B.oneOf(["horizontal","vertical","inline"]).def("horizontal"),tableAction:{type:Object},wrapperCol:Object,colon:B.bool,labelAlign:B.string,rowProps:Object};const Bt=Ie({name:"BasicForm",components:{FormItem:at,Form:$e,Row:ct,FormAction:pt},props:gt,emits:["advanced-change","reset","submit","register","field-value-change"],setup(e,{emit:r,attrs:o}){const p=we({}),h=it(),b=we({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),l=Q({}),c=Q(!1),u=Q({}),d=Q(null),v=Q(null),{prefixCls:w}=Qe("basic-form"),s=_(()=>O(O({},e),n(u))),j=_(()=>[w,{[`${w}--compact`]:n(s).compact}]),C=_(()=>{const{baseRowStyle:A={},rowProps:I}=n(s);return O({style:A},I)}),M=_(()=>O(O(O({},o),e),n(s))),m=_(()=>{const A=n(d)||n(s).schemas;for(const I of A){const{defaultValue:P,component:be,isHandleDateDefaultValue:Se=!0}=I;if(Se&&P&&je.includes(be))if(!Array.isArray(P))I.defaultValue=J(P);else{const Ae=[];P.forEach(Re=>{Ae.push(J(Re))}),I.defaultValue=Ae}}return n(s).showAdvancedButton?K(A.filter(I=>I.component!=="Divider")):K(A)}),{handleToggleAdvanced:F,fieldsIsAdvancedMap:N}=At({advanceState:b,emit:r,getProps:s,getSchema:m,formModel:p,defaultValueRef:l}),{handleFormValues:L,initDefault:$}=bt({getProps:s,defaultValueRef:l,getSchema:m,formModel:p});vt({getSchema:m,getProps:s,isInitedDefault:c,formElRef:v});const{handleSubmit:V,setFieldsValue:k,clearValidate:t,validate:a,validateFields:g,getFieldsValue:i,updateSchema:f,resetSchema:y,appendSchemaByField:T,removeSchemaByField:E,resetFields:ne,scrollToField:oe}=yt({emit:r,getProps:s,formModel:p,getSchema:m,defaultValueRef:l,formElRef:v,schemaRef:d,handleFormValues:L});lt({resetAction:ne,submitAction:V}),x(()=>n(s).model,()=>{const{model:A}=n(s);!A||k(A)},{immediate:!0}),x(()=>n(s).schemas,A=>{y(A!=null?A:[])}),x(()=>m.value,A=>{he(()=>{var I;(I=h==null?void 0:h.redoModalHeight)==null||I.call(h)}),!n(c)&&A!=null&&A.length&&($(),c.value=!0)}),x(()=>p,Ce(()=>{n(s).submitOnChange&&V()},300),{deep:!0});function S(A){return D(this,null,function*(){u.value=Ve(n(u)||{},A)})}function R(A,I,P){p[A]=I,r("field-value-change",A,I),P&&P.itemProps&&!P.itemProps.autoLink&&g([A]).catch(be=>{})}function z(A){const{autoSubmitOnEnter:I}=n(s);if(!!I&&A.key==="Enter"&&A.target&&A.target instanceof HTMLElement){const P=A.target;P&&P.tagName&&P.tagName.toUpperCase()=="INPUT"&&V()}}const Z={getFieldsValue:i,setFieldsValue:k,resetFields:ne,updateSchema:f,resetSchema:y,setProps:S,removeSchemaByField:E,appendSchemaByField:T,clearValidate:t,validateFields:g,validate:a,submit:V,scrollToField:oe};return xe(()=>{$(),r("register",Z)}),O({getBindValue:M,handleToggleAdvanced:F,handleEnterPress:z,formModel:p,defaultValueRef:l,advanceState:b,getRow:C,getProps:s,formElRef:v,getSchema:m,formActionType:Z,setFormModel:R,getFormClass:j,getFormActionBindProps:_(()=>O(O({},s.value),b)),fieldsIsAdvancedMap:N},Z)}});function Ft(e,r,o,p,h,b){const l=H("FormItem"),c=H("FormAction"),u=H("Row"),d=H("Form");return q(),X(d,ee(e.getBindValue,{class:e.getFormClass,ref:"formElRef",model:e.formModel,onKeypress:nt(e.handleEnterPress,["enter"])}),{default:Y(()=>[ie(u,ae(fe(e.getRow)),{default:Y(()=>[U(e.$slots,"formHeader"),(q(!0),et(tt,null,de(e.getSchema,v=>(q(),X(l,{key:v.field,isAdvanced:e.fieldsIsAdvancedMap[v.field],tableAction:e.tableAction,formActionType:e.formActionType,schema:v,formProps:e.getProps,allDefaultValues:e.defaultValueRef,formModel:e.formModel,setFormModel:e.setFormModel},Oe({_:2},[de(Object.keys(e.$slots),w=>({name:w,fn:Y(s=>[U(e.$slots,w,ae(fe(s||{})))])}))]),1032,["isAdvanced","tableAction","formActionType","schema","formProps","allDefaultValues","formModel","setFormModel"]))),128)),ie(c,ee(e.getFormActionBindProps,{onToggleAdvanced:e.handleToggleAdvanced}),Oe({_:2},[de(["resetBefore","submitBefore","advanceBefore","advanceAfter"],v=>({name:v,fn:Y(w=>[U(e.$slots,v,ae(fe(w||{})))])}))]),1040,["onToggleAdvanced"]),U(e.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"])}var Rt=De(Bt,[["render",Ft]]);export{Rt as B};
